//------------------------------------------------------------

package file

import (
	"fmt"
	"testing"

	"gopkg.in/yaml.v3"
)

//------------------------------------------------------------

var testUUID = "346a4513-7afd-41d2-acd1-30d185172e21"

//------------------------------------------------------------
//############################################################
//------------------------------------------------------------

func TestReadYAMLFile(t *testing.T) {
	//------------------------------------------------------------
	var err error
	//------------------------------------------------------------
	var yamlData map[string]any
	//------------------------------------------------------------

	//--------------------
	yamlData, err = ReadYAMLFile("file_yaml_test.yaml")
	//--------------------

	//------------------------------------------------------------
	if err != nil {

		t.Error(err)

	} else {

		if yamlData == nil {

			t.Error("yamlData should not be nil")

		} else {

			//--------------------
			if yamlData["UUID"] != testUUID {

				t.Errorf("yamlData[\"UUID\"] equals %q but should equal %q\n", yamlData["UUID"], testUUID)
			}
			//--------------------
		}
		//--------------------
	}
	//------------------------------------------------------------
}

//------------------------------------------------------------

func TestAddYamlResolvers(t *testing.T) {
	//------------------------------------------------------------
	var err error
	//------------------------------------------------------------
	var yamlData map[string]any
	//------------------------------------------------------------

	//--------------------
	AddYamlResolvers("!ord", resolveOrd)
	//--------------------

	//--------------------
	yamlData, err = ReadYAMLFile("file_yaml_test.yaml")
	//--------------------

	//------------------------------------------------------------
	if err != nil {

		t.Error(err)

	} else {

		if yamlData == nil {

			t.Error("yamlData should not be nil")

		} else {

			//--------------------
			if yamlData["charToOrd"] != "65" {

				t.Errorf("yamlData[\"charToOrd\"] equals %q but should equal %q\n", yamlData["charToOrd"], "65")
			}
			//--------------------
		}
		//--------------------
	}
	//------------------------------------------------------------
}

//------------------------------------------------------------
//############################################################
//------------------------------------------------------------

//------------------------------------------------------------
// resolveOrd
//------------------------------------------------------------

func resolveOrd(node *yaml.Node) (*yaml.Node, error) {

	var err error

	node.Value = fmt.Sprint(int(node.Value[0]))

	return node, err
}

//------------------------------------------------------------
//############################################################
//------------------------------------------------------------
